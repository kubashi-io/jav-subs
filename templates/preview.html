<!doctype html>
<html>
<head>
    <title>Scan Preview</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<div class="container">

    <h1>Scan Preview</h1>

    <p>Folder: {{ root_dir }}</p>

    <!-- FILTER BAR -->
    <div class="filter-bar">
        <button type="button" class="filter-btn" data-filter="all">All</button>
        <button type="button" class="filter-btn" data-filter="missing">Missing Only</button>
        <button type="button" class="filter-btn" data-filter="existing">Existing Only</button>
    </div>

    <table class="preview-table">
        <tr>
            <th>File</th>
            <th>Code</th>
            <th>Status</th>
        </tr>

        {% for v in files %}
        <tr class="preview-row {% if v.has_sub %}has-sub{% else %}missing-sub{% endif %}">
            <td>{{ v.file }}</td>
            <td>{{ v.code }}</td>
            <td>
                {% if v.has_sub %}
                    <span class="badge badge-ok">Subtitle already exists</span>
                {% else %}
                    <span class="badge badge-missing">Missing subtitle</span>
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </table>

    <form method="get" action="{{ url_for('index') }}">
        <button class="btn btn-secondary">Back</button>
    </form>

    <footer class="footer">
        Build: {{ build_sha }}
    </footer>

</div>

<script>
document.querySelectorAll(".filter-btn").forEach(btn => {
    btn.addEventListener("click", () => {
        const filter = btn.dataset.filter;
        const rows = document.querySelectorAll(".preview-row");

        rows.forEach(row => {
            if (filter === "all") {
                row.style.display = "";
            } else if (filter === "missing") {
                row.style.display = row.classList.contains("missing-sub") ? "" : "none";
            } else if (filter === "existing") {
                row.style.display = row.classList.contains("has-sub") ? "" : "none";
            }
        });
    });
});
</script>

</body>
</html>
